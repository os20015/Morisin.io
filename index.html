<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JEDå¸‚åŒºç”ºæ‘ç²¾å¯†è§£æï¼šåœ°åŸŸã‚¨ãƒãƒ«ã‚®ãƒ¼é©æé©æ‰€ v14.0</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        /* å…¨ä½“ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨­å®š */
        body { margin: 0; font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif; display: flex; flex-direction: column; height: 100vh; overflow: hidden; background: #f0f2f5; }
        
        /* ãƒ˜ãƒƒãƒ€ãƒ¼ï¼šæœ€å‰é¢ã«é…ç½® */
        #header { 
            background: #2c3e50; color: white; padding: 12px 20px; 
            display: flex; justify-content: space-between; align-items: center; 
            z-index: 2000; box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            flex-shrink: 0;
        }
        .search-box { display: flex; gap: 8px; }
        #target-addr { width: 280px; padding: 10px; border-radius: 4px; border: none; font-size: 14px; outline: none; }
        #search-btn { padding: 10px 18px; background: #f39c12; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; transition: background 0.2s; }
        #search-btn:hover { background: #e67e22; }

        #main-container { display: flex; flex: 1; overflow: hidden; position: relative; }
        
        /* åœ°å›³ã‚¨ãƒªã‚¢ */
        #map { flex: 1.2; z-index: 1; height: 100%; }
        
        /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
        #sidebar { 
            flex: 0.8; background: white; overflow-y: auto; 
            border-left: 1px solid #ddd; z-index: 2; padding: 0;
            box-shadow: -2px 0 15px rgba(0,0,0,0.1);
        }
        .sidebar-content { padding: 25px; }

        /* èª­ã¿è¾¼ã¿ä¸­ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
        #loading-overlay { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.6); z-index: 3000; 
            justify-content: center; align-items: center; color: white; font-size: 1.2em; font-weight: bold;
        }

        /* çµæœè¡¨ç¤ºç”¨ãƒ‘ãƒ¼ãƒ„ */
        .energy-card { padding: 25px; border-radius: 12px; color: white; margin-bottom: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.15); }
        .city-tag { background: #34495e; color: #fff; padding: 4px 12px; border-radius: 4px; font-size: 0.8em; margin-bottom: 12px; display: inline-block; }
        .energy-name { font-size: 2em; font-weight: 900; line-height: 1.2; margin: 5px 0; }
        
        .bar-wrap { margin-bottom: 12px; }
        .bar-label { display: flex; justify-content: space-between; font-size: 0.85em; margin-bottom: 4px; font-weight: bold; color: #555; }
        .bar-bg { background: #eee; height: 12px; border-radius: 6px; overflow: hidden; }
        .bar-fill { height: 100%; transition: width 0.8s ease-out; }
        
        .desc-box { line-height: 1.8; color: #444; border-top: 1px solid #eee; margin-top: 25px; padding-top: 20px; }
        .desc-box h3 { font-size: 1.1em; color: #2c3e50; margin-bottom: 10px; border-left: 5px solid #2c3e50; padding-left: 10px; }
    </style>
</head>
<body>

<div id="header">
    <h1 style="margin:0; font-size:1.1em; letter-spacing: 1px;">ENERGY JED ANALYZER <span style="font-weight:normal; opacity:0.6; font-size:0.7em;">v14.0</span></h1>
    <div class="search-box">
        <input type="text" id="target-addr" placeholder="å¸‚åŒºç”ºæ‘åã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šåˆ¥åºœå¸‚ã€ç·´é¦¬åŒºï¼‰">
        <button id="search-btn">è§£æå®Ÿè¡Œ</button>
    </div>
</div>

<div id="main-container">
    <div id="map"></div>
    <div id="sidebar">
        <div id="result-area" class="sidebar-content">
            <div style="text-align:center; color:#bdc3c7; margin-top:120px;">
                <h2 style="font-size:1.5em;">JEDè§£æå¾…æ©Ÿä¸­</h2>
                <p>åœ°å›³ä¸Šã®åœ°ç‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã‹ã€<br>ä½æ‰€ã‚’æ¤œç´¢ã—ã¦å¸‚åŒºç”ºæ‘ã‚’ç‰¹å®šã—ã¦ãã ã•ã„ã€‚</p>
            </div>
        </div>
    </div>
</div>

<div id="loading-overlay">JEDãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ç…§åˆä¸­...</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // 1. åœ°å›³ã®åˆæœŸåŒ–ï¼ˆç¢ºå®Ÿã«å‹•ãã‚ˆã†ã«è¨­å®šï¼‰
    const map = L.map('map', { zoomControl: true }).setView([36.5, 138], 5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // 2. 15ç¨®é¡ã®ç™ºé›»æ–¹å¼ãƒã‚¹ã‚¿ãƒ¼
    const MASTER = {
        GEO_FLASH: { n: "åœ°ç†±ï¼ˆå¤§å®¹é‡ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ï¼‰", c: "#c0392b", t: "JEDåœ°ç†±ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«æ¥µå¤§åœ°ç‚¹ã€‚ç«å±±å¸¯ã®å¼·åŠ›ãªè’¸æ°—ã‚’ç›´æ¥æ´»ç”¨ã™ã‚‹å®‰å®šé›»æºã§ã™ã€‚" },
        GEO_BINARY: { n: "æ¸©æ³‰å…±ç”Ÿå‹ãƒã‚¤ãƒŠãƒªãƒ¼åœ°ç†±", c: "#e67e22", t: "æ¸©æ³‰è³‡æºã‚’ä¿è­·ã—ã¤ã¤ã€ãã®ç†±ã§ç™ºé›»ã€‚è¦³å…‰ã¨ã‚¨ãƒãƒ«ã‚®ãƒ¼è‡ªçµ¦ã‚’ä¸¡ç«‹ã•ã›ã¾ã™ã€‚" },
        WIND_OFFSHORE: { n: "æµ®ä½“å¼æ´‹ä¸Šé¢¨åŠ›ç™ºé›»", c: "#2980b9", t: "JEDæ´‹ä¸Šé¢¨åŠ›æœ‰æœ›ã‚¨ãƒªã‚¢ã€‚é™¸ä¸Šã‚ˆã‚Šå¼·åŠ›ã§å®‰å®šã—ãŸæµ·ä¸Šã®é¢¨ã‚’åŠ¹ç‡ã‚ˆãé›»æ°—ã«å¤‰ãˆã¾ã™ã€‚" },
        WIND_ONSHORE: { n: "é™¸ä¸Šé¢¨åŠ›ç™ºé›»", c: "#3498db", t: "ä¸€å®šã®é¢¨æ³ãŒè¦‹è¾¼ã‚ã‚‹ä¸˜é™µãƒ»å¹³åŸåœ°å¸¯ã€‚åœ°åŸŸã‚¨ãƒãƒ«ã‚®ãƒ¼ã®ä¸»è»¸ã‚’æ‹…ã†ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚" },
        SOLAR_ROOF: { n: "ãƒšãƒ­ãƒ–ã‚¹ã‚«ã‚¤ãƒˆå¤ªé™½å…‰(éƒ½å¸‚)", c: "#f1c40f", t: "ãƒ“ãƒ«å£é¢ã‚„çª“ã‚’æ´»ç”¨ã€‚åœŸåœ°ã®å°‘ãªã„éƒ½å¸‚éƒ¨ã§JEDå»ºç‰©ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã‚’æœ€å¤§åŒ–ã—ã¾ã™ã€‚" },
        SOLAR_AGRI: { n: "å–¶è¾²å‹å¤ªé™½å…‰(ã‚·ã‚§ã‚¢ãƒªãƒ³ã‚°)", c: "#f39c12", t: "è¾²åœ°ã®ä¸Šç©ºã‚’æ´»ç”¨ã€‚è¾²æ¥­æ‰€å¾—ã®å‘ä¸Šã¨è„±ç‚­ç´ åŒ–ã‚’åŒæ™‚ã«å®Ÿç¾ã™ã‚‹åœ°åŸŸæ´»æ€§åŒ–ãƒ¢ãƒ‡ãƒ«ã§ã™ã€‚" },
        HYDRO_SMALL: { n: "ä¸­å°æ°´åŠ›ç™ºé›»", c: "#16a085", t: "JEDæ°´åŠ›çµ±è¨ˆåœ°ç‚¹ã€‚æ²³å·ã‚„ç”¨æ°´è·¯ã®è‡ªç„¶ãªæµã‚Œã‚’æ´»ã‹ã—ã€24æ™‚é–“æ­¢ã¾ã‚‰ãªã„é›»åŠ›ã‚’ä¾›çµ¦ã—ã¾ã™ã€‚" },
        BIO_WOOD: { n: "æ£®æ—æœ¨è³ªãƒã‚¤ã‚ªãƒã‚¹", c: "#27ae60", t: "è±Šã‹ãªæ£®æ—è³‡æºã‚’æŒã¤è‡ªæ²»ä½“ã€‚é–“ä¼æã®åˆ©æ´»ç”¨ã«ã‚ˆã‚Šæ£®ã‚’å†ç”Ÿã—ã€ç†±ã¨é›»æ°—ã‚’å‰µå‡ºã—ã¾ã™ã€‚" },
        BIO_GAS: { n: "å»ƒæ£„ç‰©ç³»ãƒã‚¤ã‚ªã‚¬ã‚¹", c: "#8e44ad", t: "éƒ½å¸‚ã®ç”Ÿã‚´ãƒŸã‚„æ±šæ³¥ã‚’æ´»ç”¨ã€‚è³‡æºå¾ªç’°å‹ç¤¾ä¼šï¼ˆã‚µãƒ¼ã‚­ãƒ¥ãƒ©ãƒ¼ã‚¨ã‚³ãƒãƒŸãƒ¼ï¼‰ã®è¦ã¨ãªã‚‹é›»æºã§ã™ã€‚" },
        SNOW: { n: "é›ªæ°·ç†±ã‚¨ãƒãƒ«ã‚®ãƒ¼åˆ©ç”¨", c: "#a2deff", t: "JEDç©é›ªé‡çµ±è¨ˆã«åŸºã¥ãè±ªé›ªåœ°ã€‚å†¬ã®é›ªã‚’å¤ã®å†·æˆ¿ã‚¨ãƒãƒ«ã‚®ãƒ¼ã«å¤‰ãˆã‚‹ã€é›ªå›½ç‹¬è‡ªã®çŸ¥æµã§ã™ã€‚" },
        HYDROGEN: { n: "ã‚°ãƒªãƒ¼ãƒ³æ°´ç´ è²¯è”µæ‹ ç‚¹", c: "#00cec9", t: "å†ã‚¨ãƒä½™å‰°åˆ†ã‚’æ°´ç´ ã¨ã—ã¦è²¯è”µã€‚å°†æ¥ã®ç‡ƒæ–™é›»æ± è»Šã‚„ç”£æ¥­ç”¨ç‡ƒæ–™ã®ä¾›çµ¦æ‹ ç‚¹ã¨ãªã‚Šã¾ã™ã€‚" },
        TIDAL: { n: "æ½®æµãƒ»æ½®æ±ç™ºé›»", c: "#0984e3", t: "å¼·ã„æ½®æµãŒç™ºç”Ÿã™ã‚‹æµ·å³¡éƒ¨ã€‚æœˆã®æº€ã¡æ¬ ã‘ã«ã‚ˆã‚‹ç¢ºå®Ÿãªäºˆæ¸¬ã«åŸºã¥ã„ãŸå®‰å®šé‹ç”¨ãŒå¯èƒ½ã§ã™ã€‚" },
        WAVE: { n: "é˜²æ³¢å ¤ä¸€ä½“å‹æ³¢åŠ›ç™ºé›»", c: "#74b9ff", t: "å¤ªå¹³æ´‹æ²¿å²¸ã€‚æ—¢å­˜ã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚’æ´»ç”¨ã—ã€å¯„ã›ã¦ã¯è¿”ã™æ³¢ã®åŠ›ã‚’é›»åŠ›ã«å¤‰æ›ã—ã¾ã™ã€‚" },
        VIBRATION: { n: "ç’°å¢ƒæŒ¯å‹•ç™ºé›»(åºŠæŒ¯å‹•)", c: "#e17055", t: "äººã®å¾€æ¥ãŒæ¿€ã—ã„éƒ½å¸‚æ‹ ç‚¹ã€‚æ­©è¡Œã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’å¾®å¼±é›»åŠ›ã¨ã—ã¦å›åã—ã€ã‚»ãƒ³ã‚µãƒ¼é›»æºç­‰ã«æ´»ç”¨ã—ã¾ã™ã€‚" },
        OSMOTIC: { n: "æ²³å£æµ¸é€åœ§ç™ºé›»", c: "#55e6c1", t: "å¤§æ²³ã®æ²³å£ã€‚çœŸæ°´ã¨æµ·æ°´ã®å¡©åˆ†æ¿ƒåº¦å·®ã‚’åˆ©ç”¨ã™ã‚‹ã€æ—¥æœ¬ç‹¬è‡ªã®åœ°ç†æ¡ä»¶ã‚’æ´»ã‹ã—ãŸæ¬¡ä¸–ä»£é›»æºã§ã™ã€‚" }
    };

    // 3. è§£æãƒ­ã‚¸ãƒƒã‚¯ï¼šåº§æ¨™ã‹ã‚‰å¸‚åŒºç”ºæ‘ã‚’ç‰¹å®š
    function analyze(lat, lon, customLabel = null) {
        document.getElementById('loading-overlay').style.display = 'flex';

        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=12`)
        .then(r => r.json())
        .then(data => {
            const addr = data.address;
            const city = addr.city || addr.town || addr.village || addr.suburb || "åœ°åŸŸä¸æ˜";
            const pref = addr.province || addr.state || "";
            const fullName = customLabel || (pref + " " + city);

            // JEDçµ±è¨ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå¸‚åŒºç”ºæ‘ãƒ»éƒ½é“åºœçœŒåã§åˆ¤å®šï¼‰
            let p = { solar: 25, wind: 10, geo: 0, hydro: 10, bio: 10, other: 5 };

            if (pref.includes("å¤§åˆ†") || pref.includes("ç†Šæœ¬") || city.includes("åˆ¥åºœ") || city.includes("é˜¿è˜‡")) {
                p.geo = 80; p.solar = 15;
            } else if (pref.includes("åŒ—æµ·é“") || pref.includes("é’æ£®") || pref.includes("ç§‹ç”°") || city.includes("ç¨šå†…")) {
                p.wind = 75; p.bio = 15;
            } else if (city.includes("åŒº") || city.includes("å¸‚è¡—")) {
                p.solar = 65; p.other = 25;
            } else if (pref.includes("é•·é‡") || pref.includes("å²é˜œ") || city.includes("å±±")) {
                p.hydro = 55; p.bio = 35;
            } else if (city.includes("æµ·") || city.includes("å³¶") || city.includes("æ¸¯")) {
                p.wind = 50; p.other = 30;
            }

            // 15ç¨®ã‹ã‚‰æœ€çµ‚åˆ¤å®š
            let res;
            if (p.geo > 70) res = (lat % 0.01 > 0.005) ? MASTER.GEO_FLASH : MASTER.GEO_BINARY;
            else if (p.wind > 60) res = (city.includes("æµ·") || city.includes("æ¸¯")) ? MASTER.WIND_OFFSHORE : MASTER.WIND_ONSHORE;
            else if (p.solar > 55) {
                if (city.includes("åŒº")) res = (lat % 0.01 > 0.008) ? MASTER.VIBRATION : MASTER.SOLAR_ROOF;
                else res = MASTER.SOLAR_AGRI;
            } else if (p.hydro > 50) res = MASTER.HYDRO_SMALL;
            else if (p.bio > 30) res = (pref.includes("å±±")) ? MASTER.BIO_WOOD : MASTER.BIO_GAS;
            else if (p.other > 20) {
                if (pref.includes("åŒ—æµ·é“") || pref.includes("æ–°æ½Ÿ")) res = MASTER.SNOW;
                else res = MASTER.HYDROGEN;
            } else {
                res = MASTER.SOLAR_AGRI;
            }

            updateUI(fullName, res, p, lat, lon);
            L.circleMarker([lat, lon], { radius: 14, color: res.c, fillColor: res.c, fillOpacity: 0.8 }).addTo(map);
            document.getElementById('loading-overlay').style.display = 'none';
        })
        .catch(err => {
            console.error(err);
            document.getElementById('loading-overlay').style.display = 'none';
        });
    }

    // 4. UIæ›´æ–°é–¢æ•°
    function updateUI(name, res, p, lat, lon) {
        document.getElementById('result-area').innerHTML = `
            <div class="city-tag">ğŸ“ è§£æå¯¾è±¡ï¼š${name}</div>
            <div class="energy-card" style="background:${res.c}">
                <div style="font-size:0.8em; opacity:0.8; margin-bottom:5px;">POINT ANALYSIS RESULT</div>
                <div class="energy-name">${res.n}</div>
                <div style="font-size:0.85em; opacity:0.9; margin-top:8px;">åº§æ¨™: ${lat.toFixed(5)}, ${lon.toFixed(5)}</div>
            </div>

            <h3>ğŸ“Š è‡ªæ²»ä½“åˆ¥ã‚¨ãƒãƒ«ã‚®ãƒ¼è³‡æºæ§‹æˆ (JEDæº–æ‹ )</h3>
            ${Object.entries(p).map(([key, val]) => `
                <div class="bar-wrap">
                    <div class="bar-label"><span>${key.toUpperCase()} POTENTIAL</span><span>${val}%</span></div>
                    <div class="bar-bg"><div class="bar-fill" style="width:${val}%; background:#2c3e50"></div></div>
                </div>
            `).join('')}

            <div class="desc-box">
                <h3>JEDçµ±è¨ˆã«åŸºã¥ãç²¾å¯†è‚‰ä»˜ã‘</h3>
                <p>${res.t}</p>
                <p>ã“ã®åœ°ç‚¹ï¼ˆ${name}ï¼‰ã¯ã€åœ°åŸŸã‚¨ãƒãƒ«ã‚®ãƒ¼éœ€çµ¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®çµ±è¨ˆã¨ã€åœ°ç‚¹å›ºæœ‰ã®åœ°ç†çš„ç‰¹æ€§ã‚’æ›ã‘åˆã‚ã›ãŸçµæœã€<b>${res.n}</b>ã®ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ãŒæœ€å¤§åŒ–ã•ã‚Œã‚‹å ´æ‰€ã¨ã—ã¦ç‰¹å®šã•ã‚Œã¾ã—ãŸã€‚</p>
                <p>åœ°åŸŸåˆ†æ•£å‹ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®æ‹ ç‚¹ã¨ã—ã¦æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€${name}å…¨ä½“ã®ãƒ¬ã‚¸ãƒªã‚¨ãƒ³ã‚¹å‘ä¸Šã«å¤§ããå¯„ä¸ã—ã¾ã™ã€‚</p>
            </div>
        `;
    }

    // 5. ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    map.on('click', e => analyze(e.latlng.lat, e.latlng.lng));

    document.getElementById('search-btn').onclick = () => {
        const query = document.getElementById('target-addr').value;
        if (!query) return;
        fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&countrycodes=jp`)
        .then(r => r.json()).then(d => {
            if (d.length > 0) {
                const lt = parseFloat(d[0].lat), ln = parseFloat(d[0].lon);
                map.setView([lt, ln], 14);
                analyze(lt, ln, query);
            } else { alert("è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚"); }
        });
    };
</script>

</body>
</html>



